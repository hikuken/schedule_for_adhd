# ADHD向けスケジュールアプリ 要件定義書（MVP v0.3）

最終更新: 2025-09-27  
作成者: 個人開発（Java / Firebase / JavaScript 想定）  
対象: **最小構成（UI 2画面＋モーダル＋終了フォロー通知）**

---

## 1. 目的・概要
ADHD特性（着手困難・記憶負荷）を軽減するため、**カレンダーで予定を把握**し、**今日やることを最小操作で完了**まで導く。  
本MVPは以下を提供する。
- フッターの2ボタンナビ（**スケジュール / 今日**）
- **スケジュール画面**（祝日・タスク表示）
- **今日のタスク画面**（未完了／完了の2列）
- **タスク追加モーダル**（新規作成・編集・削除）
- **終了フォロー通知**（未完了タスクへのランダム再通知）

> 注: **実装方針は本書に含めない。**

---

## 2. スコープ（本MVPで提供）
- フッターナビ: **スケジュール / 今日** の2ボタン
- スケジュール画面: 月カレンダー、祝日表示、タスク存在表示、日付タップでモーダル起動
- 今日のタスク画面: **タスク列**（開始時刻昇順）／**完了列**（完了時刻降順）、タスク追加ボタン、チェックで完了移動、カードタップで編集
- タスク追加モーダル: **タスクの内容 / 開始時間 / 終了時間 / 繰り返し（毎日・毎週・毎月・毎年） / サブタスク / メモ**、**保存 / 削除**
- **終了フォロー通知**: 終了時刻を過ぎても未完了のタスクに対し、**完了するまで**ランダムなタイミングで**継続通知**

※ 外部カレンダー同期、開始前通知、統計/学習、アカウント機能などは非スコープ。

---

## 3. 画面・ナビゲーション要件

### 3.1 グローバルUI（フッターナビ）
- **UI-001**: フッターに2ボタン（**スケジュール / 今日**）
- **UI-002**: 現在地のタブを強調表示（色/アイコン/下線のいずれか）

### 3.2 スケジュール画面
- **CAL-001**: **月カレンダー表示**（iOS標準「カレンダー」の月表示に準拠）
- **CAL-002**: **日本の祝日**を表示（色/ドット/ラベルのいずれか）
- **CAL-003**: **タスク存在**を簡易表示（ドット/細バー等、複数件時は複数ドットまたは+件数）
- **CAL-004**: **日付セルタップ**で**タスク追加モーダル**（初期日付＝タップ日）
- **CAL-005**: 月移動（左右スワイプ/ナビゲーション）

### 3.3 今日のタスク画面
- **TODAY-001**: **2列レイアウト**（左: タスク列 / 右: 完了列）
- **TODAY-002**: タスク列上部に**タスク追加ボタン**（初期日付＝今日）
- **TODAY-003**: **タスク列**は**開始時刻昇順**（未設定は末尾）、各カード左に**空のチェック**
- **TODAY-004**: **チェック押下**でタスクを**完了列**へ移動し、タスク列から削除
- **TODAY-005**: **完了列**は**完了時刻降順**で表示
- **TODAY-006**: タスクカード本体タップで**タスク追加モーダル（編集）**を開く

### 3.4 タスク追加モーダル（新規/編集共通）
- **MODAL-001 入力項目**:
  - **タスクの内容**（必須）
  - **開始時間**（任意）
  - **終了時間**（任意 / 開始≦終了）
  - **繰り返し**（任意 / 毎日・毎週・毎月・毎年）
  - **サブタスク**（0..n）
  - **メモ**
- **MODAL-002 操作**: **保存 / 削除（編集時のみ活性）**
- **MODAL-003 初期値**: 新規＝呼出元日（カレンダー日/今日）、編集＝既存値
- **MODAL-004 繰り返し解釈**:
  - 毎週＝開始日の**曜日**
  - 毎月＝開始日の**日付**（31日等がない月は**最終日**へ丸め）
  - 毎年＝**月日**（2/29は**2/28**に丸め）

---

## 4. 機能要件（Functional Requirements）

### 4.1 タスク管理
- **FR-001**: タスクの新規作成（必須=タスクの内容）
- **FR-002**: タスクの編集
- **FR-003**: タスクの削除（編集時のみ）
- **FR-004**: 開始/終了、繰り返し、サブタスク、メモの付与
- **FR-005**: 今日画面での**チェック操作**により**完了**へ移動
- **FR-006**: スケジュール画面に**祝日**と**タスク存在**を表示
- **FR-007**: カレンダー日付タップで当該日を初期値として新規作成
- **FR-008**: 今日画面の追加ボタンから新規作成（初期日付＝今日）

### 4.2 表示・並び順
- **FR-009**: タスク列＝**開始時刻昇順**（未設定は末尾）
- **FR-010**: 完了列＝**完了時刻降順**
- **FR-011**: カレンダー初期表示＝**当月**

### 4.3 バリデーション
- **FR-012**: 「タスクの内容」未入力は保存不可
- **FR-013**: 開始/終了の両方が入力されている場合は**開始≦終了**
- **FR-014**: 繰り返し設定に必要な開始情報が欠落している場合は保存不可

### 4.4 通知（終了フォロー通知）
- **NTF-001 対象タスク**:  
  - **終了時間が設定**され、終了時間の時点で**未完了**（status ≠ done）のタスク
- **NTF-002 初回通知ウィンドウ**:  
  - **終了時間〜終了時間+1時間**の範囲で**ランダムな1時刻**に通知
- **NTF-003 再通知ウィンドウ（継続）**:  
  - 初回通知時刻を **T₁** とする。**未完了**であれば、以降**直前の通知時刻 Tₙ〜Tₙ+1時間**の範囲で**ランダムな1時刻**に**次回通知**を行う  
  - この再通知を**タスクが完了するまで継続**する（回数上限なし）
- **NTF-004 抑止条件**:  
  - 通知予定時刻の時点で当該タスクが**完了**している場合、以降の通知は**行わない**
  - **終了時間未設定**のタスクは対象外
- **NTF-005 文言**:  
  - 「**『{タスクの内容}』は完了しましたか？**」  
  - `{タスクの内容}` に当該タスクのタイトルを差し込み
- **NTF-006 繰り返しタスク**:  
  - 各**発生回（インスタンス）**を個別に判定。未完了なら上記ロジックを適用
- **NTF-007 権限と前提**:  
  - 端末の**通知許可**が得られていない場合、通知は表示されない
- **NTF-008 タイムゾーン/言語**:  
  - **Asia/Tokyo**、日本語固定（本MVP）

---

## 5. 非機能要件（NFR）
- **NFR-001**: 主要操作（画面遷移・保存）の体感応答は概ね500ms以内（端末/回線依存）
- **NFR-002**: 既定タイムゾーン **Asia/Tokyo**
- **NFR-003**: タップ領域44pt以上、OS文字サイズに追従
- **NFR-004**: データ保持はローカル or 同期ありのいずれか（本MVPではどちらか一方で可）
- **NFR-005**: プライバシー最小。通知本文はタスクタイトルのみを含む
- **NFR-006**: オフラインでも閲覧/追加/完了が最低限成立
- **NFR-007**: 通知は端末/OS設定の影響により遅延/未達が発生し得る

---

## 6. データ要件（MVP想定スキーマ）

### 6.1 Task
| フィールド | 型 | 必須 | 説明 |
|---|---|---:|---|
| id | string | ✓ | 一意ID |
| title | string | ✓ | タスクの内容 |
| startAt | datetime/null |  | 開始日時 |
| endAt | datetime/null |  | **終了日時（通知の初回基準）** |
| repeat.type | enum(null/daily/weekly/monthly/yearly) |  | 繰り返し種別 |
| repeat.meta | object/null |  | 補助情報（例: originalDay=31） |
| subtasks | array<string> |  | サブタスク名 |
| note | string |  | メモ |
| status | enum(todo/done) | ✓ | 進行状態 |
| doneAt | datetime/null |  | 完了日時（完了列並び/通知抑止に使用） |
| createdAt / updatedAt | datetime | ✓ | 監査用 |

### 6.2 Holiday（読み取り専用）
| フィールド | 型 | 説明 |
|---|---|---|
| date | date | 祝日 |
| name | string | 祝日名 |

---

## 7. 祝日データの扱い
- 対象は**日本の祝日**（当年＋翌年を推奨）
- 実装方法（静的JSON/算出）は本書では規定しない

---

## 8. エラーハンドリング（例）
- 必須未入力: 「タスクの内容を入力してください」
- 時刻不整合: 「終了時間は開始時間以降にしてください」
- 保存失敗: 「保存に失敗しました。通信環境をご確認ください」
- 通知非許可（情報）: 「通知を受け取るには端末設定で許可が必要です」

---

## 9. 受け入れ基準（UAT）
1. **スケジュール/今日**ボタンで正しく画面遷移できる  
2. **スケジュール画面**で月カレンダー表示、祝日・タスク存在が視認できる  
3. 日付タップで**タスク追加モーダル**が開き、当該日が初期値となる  
4. **今日のタスク画面**でタスク追加→保存ができる  
5. タスク列の**チェック**でタスクが**完了列**へ移動し、タスク列から削除される  
6. タスクカードタップで**編集モード**のモーダルが開き、編集保存/削除ができる  
7. 並び順: タスク列＝開始時刻昇順（未設定末尾）、完了列＝完了時刻降順  
8. バリデーション: タイトル必須、開始≦終了  
9. **終了フォロー通知**:  
   - 終了時刻設定かつ未完了のタスクに対し、**終了〜+1h**で初回通知が1回来る  
   - 以降**直前通知時刻〜+1h**のランダム時刻で**完了まで継続**して通知される（回数上限なし）  
   - 通知予定時刻に**完了済み**なら以降の通知は**送信されない**  
   - 通知文言が「**『{タスクの内容}』は完了しましたか？**」である

---

## 10. 非スコープ（将来）
- 開始前JIT通知、サマリー通知、エスカレーション設計
- 外部カレンダー連携、アカウント/複数端末同期
- 統計/レポート、行動最適化
- 繰り返し例外（この回だけ変更・スキップ）

---

## 11. 前提・制約
- 通知表示には**端末の通知許可**が必要  
- タスクの重複/オーバーラップは許容  
- **実装方式・基盤は本書の対象外**（後続工程で定義）
